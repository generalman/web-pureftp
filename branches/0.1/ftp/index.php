<?php  	/* 'User manager for PureFTPd' is made by M.Mastenbroek 2002 - 2005	 *  For more info look at http://machiel.generaal.net	 *  Version 2.1	 *  Fork by Olivier legras	 *  Current Version : 3.0 beta	 *  Release Note :	 *  Version 3.0 beta :	 *  - Add Super Administrator	 *                 	 	 */	error_reporting(E_ERROR);	session_start();	require ('config.php');	require ('includes/files.php');	require ('language/index.php');	if ($_SESSION['Login'] != '1')	{		// header("location: index.php");		include ("includes/login.php");	}else	{		$link = mysql_connect("$DBHost", "$DBLogin", "$DBPassword");		if(!$link)			die("<br>Error: MySql server not found.<br><br>MySql error : ".mysql_error());		if (!@mysql_select_db("$DBDatabase"))			die("<br>Error: Database 'ftpusers' doesn't exist.<br><br>MySql error : ".mysql_error());		$LoginName=$_SESSION['LoginName'];				//Function				//Générer un mot de passe aléatoire :		function generer($longueur)    {    $minuscules = array('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z');        $majuscules = array('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');        $code = ''; //On déclare notre variable        for ($i = 1; $i <= $longueur; $i++)        {        //On génère un type aléatoire        $type = rand(0,2);            if ($type == 0)            {                $caractere = rand(0,9);                $code .= $caractere;            }            if ($type == 1)            {                $nbre_aleatoire = rand(0, 25);                $caractere = $majuscules[$nbre_aleatoire];                $code .= $caractere;            }            if ($type == 2)            {                $nbre_aleatoire = rand(0, 25);                $caractere = $minuscules[$nbre_aleatoire];                $code .= $caractere;            }        }    return $code; //On retourne le code généré au complet    }        //Appeler la fonction :    /*    $nbre_chars = 7; //Changez ce nombre, vous verrez ;)         $code = generer($nbre_chars);        echo $code; //On affiche le résultat :p     */				//Init Mysql Request		$table_admin  = "SELECT * FROM admin WHERE Username='$LoginName'";		$query_admin  = mysql_query($table_admin);		$table_admin_all  = "SELECT * FROM admin ORDER BY Username ASC";		$query_admin_all  = mysql_query($table_admin_all);		$DefaultDir=mysql_result($query_admin,0,"DefaultDir");		$Client=mysql_result($query_admin,0,"Client");		$QuotaClient=mysql_result($query_admin,0,"QuotaClient");				//Select Specific User		if (isset($_POST['username_box'])){       $table_users_uniq  = "SELECT * FROM users WHERE User='".$_POST['username_box']."'";    }    if (isset($_GET['username_box'])){       $table_users_uniq  = "SELECT * FROM users WHERE User='".$_GET['username_box']."'";    }    		$query_users_uniq  = mysql_query($table_users_uniq); 							//initialisation users		if ($Client=="Administrator"){		  $table_users  = "SELECT * FROM users ORDER BY User ASC";		  $query_users_restore  = mysql_query($table_users);		  $table_users_restore  = "SELECT * FROM corbeille WHERE User='".$_GET['username_box']."'";      $query_users_restore  = mysql_query($table_users_restore);                                    if ($_GET['sort']=='corbeillequotafull'){        $table_restore  = "SELECT * FROM corbeille ORDER BY QuotaSize DESC";      }      elseif ($_GET['sort']=='corbeilledir'){        $table_restore  = "SELECT * FROM corbeille ORDER BY Dir ASC";      }      elseif ($_GET['sort']=='corbeillerights'){        $table_restore  = "SELECT * FROM corbeille ORDER BY Uid ASC";      }      elseif ($_GET['sort']=='corbeillequotause'){        $table_restore  = "SELECT * FROM corbeille ORDER BY QuotaClientPercentUse DESC";      }      else{      $table_restore  = "SELECT * FROM corbeille ORDER BY User ASC";      }      $query_restore  = mysql_query($table_restore);				}		else{		      if ($_GET['sort']=='quotafull'){        $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY QuotaSize DESC";      }      elseif ($_GET['sort']=='dir'){        $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY Dir ASC";      }      elseif ($_GET['sort']=='rights'){        $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY Uid ASC";      }      elseif ($_GET['sort']=='quotause'){        $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY QuotaClientPercentUse DESC";      }      else{       $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY User ASC";      }    }    $query_users  = mysql_query($table_users);    		if (!$query_users)			die("<br>Error: Table 'users' from database 'ftpusers' doesn't exist.<br><br>MySql error : ".mysql_error());		$length_users = mysql_numrows($query_users);		$length_admin = mysql_numrows($query_admin_all);		$length_restore = mysql_numrows($query_restore);		$length_users_restore = mysql_numrows($query_restore);				// Function: compare_array ();		// Returns the position of '$word' in the array '$array'		// if '$word' does not exist the function returns '-1'		function compare_array($word,$array)		{			$iCounter = 0;			while ($iCounter < count($array))			{				if($word == $array[$iCounter])				{					return $iCounter;					break;				}				$iCounter++;			}			return -1;		}		// Creates a help balloon with some information.		function help($help_text)		{			global $LocationImages;			echo ("<img class=help src=\"$LocationImages/info.gif\" height=\"18\" width=\"16\"");			echo (" onmouseover=\"return escape('$help_text')\" hspace=\"1\" align=\"middle\" border=\"0\">");//			echo ("<img class=help src=\"$LocationImages/info.gif\" height=\"18\" width=\"16\"");//			echo (" title=\"$help_text\" hspace=\"1\" align=\"middle\" border=\"0\">");		}		// Read the userfile for example '/etc/passwd'		// todo check security settings of php		$filename = $UsersFile;		$fh = fopen($filename,"r");		$iNrofunixusers = 0;		while (!feof ($fh))		{			$line = fgets($fh,4096);			$data = explode(":",$line);			$user = trim($data[0]);			$user_id = trim($data[2]);			if ($user[0] != '#' &&					strlen($user) != 0 &&					strlen($user_id) != 0)			{				if(compare_array($user,$BlacklistUsers) == -1) // no hit				{					$unix_users[$iNrofunixusers] [0] = $user;					$unix_users[$iNrofunixusers] [1] = $user_id;					$iNrofunixusers++;				}			}		}		fclose($fh);		// Read the groupfle for example '/etc/groups'		$filename = $GroupFile;		$fh = fopen($filename,"r");		$iNrofunixgroups = 0;		while (!feof ($fh))		{			$line = fgets($fh,4096);			$data = explode(":",$line);			$group = trim($data[0]);			$group_id = trim($data[2]);			if ($group[0] != '#' &&					strlen($group) != 0 &&					strlen($group_id) != 0)			{				if(compare_array($group,$BlacklistGroups) == -1) // no hit				{					$unix_groups[$iNrofunixgroups] [0] = $group;					$unix_groups[$iNrofunixgroups] [1] = $group_id;					$iNrofunixgroups++;				}			}		}		fclose($fh);		// New user		if($_GET['new'] == 1 || empty($_POST['username_box']))			$new = 1;		$data_saved=1;        //////////////////////BEGIN- EDIT CREATE USER//////////////////////////////		// Save button is pressed		if(isset($_POST['save']))		{      			$empty_password = 0;			$vallid_password = 1;			// check if password if filled			if (strlen($_POST['password_box']) == 0 || ($_POST['password_box'] == "empty"))				$empty_password = 1;			// check for vallid password			if ($_POST['confirm_password_box'] != $_POST['password_box'])				$vallid_password = 0;			$iExistUser=0;			$QuotaFull=0;      $iCounter=0;      $block_user=0;						// Find out of user exist			while ($iCounter < $length_users)			{				$message_nr = mysql_result($query_users,$iCounter,"User");				if ($message_nr == $_POST['username_box'])				{					$iExistUser=1;					break;				}				$iCounter++;			}      $iCounter=0;            /////////////////////////// LIMITATION QUOTA //////////////////////////////      $QuotaAddition=0;      $modificationquota=0;            //Quota Client      //Recuperer le quota du client      while ($iCounter < $length_users)		{ 			$quotasize       = mysql_result($query_users,$iCounter,"QuotaSize"); 			$useractu= mysql_result($query_users,$iCounter,"User"); 			if  ($_POST['username_box']==$useractu){ 			          if  ($quotasize!=$_POST['quotasize_box']){            //On additionne la nouvelle valeur et non l'ancienne                       $QuotaAddition =   $QuotaAddition +  $_POST['quotasize_box'];                        $modificationquota=1;          }       }       else{           $QuotaAddition= $QuotaAddition +  $quotasize;       } 			      	$iCounter++;             }     //cas ou l'utilisateur n'existe pas      if ($iExistUser != 1)			{        $QuotaAddition =   $QuotaAddition +  $_POST['quotasize_box'];      }      //on ajoute le quota du nouvel utilisateur                          $QuotaGlobal  = mysql_result($query_admin,0,"QuotaClient");             if ($QuotaGlobal<$QuotaAddition){                  $QuotaFull=1;      }      //Additionner les quotas des utilisateurs du client      // Si La somme est superieur strict au quota client      // Message d'erreur. Vous avez épuisé votre quota           /////////////////////////////FIN LIMITATION QUOTA /////////////////      			if ($iExistUser == 1)			{                if ($QuotaFull==1){          echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");					echo ("<!--\n\n");					echo ("  alert(\"".$Translate[111]."\");\n\n");					echo ("-->\n");					echo ("</script>\n");					                }        else{        				//  update current ftp account				if ($vallid_password == 0)				{					echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");					echo ("<!--\n\n");					echo ("  alert(\"".$Translate[21]."\");\n\n");					echo ("-->\n");					echo ("</script>\n");				}else				{  				if ($empty_password == 1) // update without password  				{    						echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  						echo ("<!--\n\n");  						echo ("  alert(\"".$Translate[22]."\");\n\n");  						echo ("-->\n");  						echo ("</script>\n");                 $block_user  = mysql_result($query_users_uniq,0,"block");                    if    ($block_user=="1") {                   $_POST['status_box']=0;                   	echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  					       	echo ("<!--\n\n");  					       	echo ("  alert(\"".$Translate[118]."\");\n\n");  					       	echo ("-->\n");  						      echo ("</script>\n");                }        						if(!mysql_query("UPDATE users SET Uid='".$_POST['uid_box']."',  																							Gid='".$_POST['gid_box']."',  																							Dir='".$_POST['dir_box']."',  																							QuotaFiles='".$_POST['quotafiles_box']."',  																							QuotaSize='".$_POST['quotasize_box']."',  																							ULBandwidth='".$_POST['ulbandwidth_box']."',  																							DLBandwidth='".$_POST['dlbandwidth_box']."',  																							ULRatio='".$_POST['ulratio_box']."',  																							DLRatio='".$_POST['dlratio_box']."',  																							Status='".$_POST['status_box']."',  																							Ipaddress='".$_POST['ipaddress_box']."',  																							Client='".$_POST['client_box']."',  																							Comment='".$_POST['comment_box']."'  																							WHERE User='".$_POST['username_box']."'",$link))  						{  							echo ("<br>Error: Not a valid UPDATE query.<br>");  							echo ("<br>MySql error : ".mysql_error());      						}  					}else  					{   					  						if(!mysql_query("UPDATE users SET Password='".md5($_POST['password_box'])."',  																					Uid='".$_POST['uid_box']."',  																					Gid='".$_POST['gid_box']."',  																					Dir='".$_POST['dir_box']."',  																					QuotaFiles='".$_POST['quotafiles_box']."',  																					QuotaSize='".$_POST['quotasize_box']."',  																					ULBandwidth='".$_POST['ulbandwidth_box']."',  																					DLBandwidth='".$_POST['dlbandwidth_box']."',  																					ULRatio='".$_POST['ulratio_box']."',  																					DLRatio='".$_POST['dlratio_box']."',  																					Status='".$_POST['status_box']."',  																					Ipaddress='".$_POST['ipaddress_box']."',  																					Client='".$_POST['client_box']."',                                            Comment='".$_POST['comment_box']."'  																					WHERE User='".$_POST['username_box']."'",$link))  						{  							echo ("<br>Error: Not a valid UPDATE query.<br>");  							echo ("<br>MySql error : ".mysql_error());    						}else  						{  							echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  							echo ("<!--\n\n");  							echo ("  alert(\"".$Translate[23]."\");\n\n");  							echo ("-->\n");  							echo ("</script>\n");  							break;  						}  					}  				}				}			}else // New user			{        if ($QuotaFull==1){            echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  					echo ("<!--\n\n");  					echo ("  alert(\"".$Translate[110]."\");\n\n");  					echo ("-->\n");  					echo ("</script>\n");  					                    }          else{            				// Create new User  				if ($vallid_password == 0 || $empty_password == 1)  				{  					echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  					echo ("<!--\n\n");  					echo ("  alert(\"".$Translate[21]."\");\n\n");  					echo ("-->\n");  					echo ("</script>\n");  					$data_saved = 0;  				}else  				{  				 if  ($_POST['uid_box']!="2001"){               if (!is_dir($_POST['dir_box']))                  $_POST['status_box']=0;                  $block_user=1;                 echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  					     echo ("<!--\n\n");  					     echo ("  alert(\"".$Translate[114]."\");\n\n");  					     echo ("-->\n");  					     echo ("</script>\n");           }  				  					if(!mysql_query("INSERT INTO users (User,Password,Uid,Gid,Dir,QuotaFiles,QuotaSize,ULBandwidth,DLBandwidth,ULRatio,dLRatio,Status,Ipaddress,Client,block,Comment)  																							VALUES ('".$_POST['username_box']."',  																							'".md5($_POST['password_box'])."',  																							'".$_POST['uid_box']."',  																							'".$_POST['gid_box']."',  																							'".$_POST['dir_box']."',  																							'".$_POST['quotafiles_box']."',  																							'".$_POST['quotasize_box']."',  																							'".$_POST['ulbandwidth_box']."',  																							'".$_POST['dlbandwidth_box']."',  																							'".$_POST['ulratio_box']."',  																							'".$_POST['dlratio_box']."',  																							'".$_POST['status_box']."',  																							'".$_POST['ipaddress_box']."',  																							'".$_POST['client_box']."',  																							'".$block_user."',  																							'".$_POST['comment_box']."')",$link))  					{  							echo ("<br>Error: Not a valid INSERT query.<br>");  							echo ("<br>MySql error : ".mysql_error());  					}  				}				}			}			// reload the database users			if ($Client=="Administrator"){		  $table_users  = "SELECT * FROM users ORDER BY User ASC";		  				}		else{               $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY User ASC";          }    echo  $table_users;    $query_users  = mysql_query($table_users);    		if (!$query_users)			die("<br>Error: Table 'users' from database 'ftpusers' doesn't exist.<br><br>MySql error : ".mysql_error());		$length_users = mysql_numrows($query_users);		}    //////////////////////END - EDIT CREATE USER//////////////////////////////    //////////////////////BEGIN - EDIT CREATE ADMIN///////////////////////////                /*$user             = $_POST['admin3'];			$admin3_password  = $_POST['admin3_password'];			$admin3_password_confirm = $_POST['admin3_password_confirm'];			$admin3_dir       = $_POST['admin3_dir'];			$admin3_client    = $_POST['admin3_client'];			$admin3_quota    = $_POST['admin3_quota'];  */						              // Save button is pressed			if(isset($_POST['save_admin']))		{      			$emptyadmin_password = 0;			$vallidadmin_password = 1;									// check if password if filled			if (strlen($_POST['admin3_password']) == 0 || ($_POST['admin3_password'] == "empty")){				$emptyadmin_password = 1;				         }			// check for vallid password			if ($_POST['admin3_password_confirm'] != $_POST['admin3_password']){				$vallidadmin_password = 0;				        }         echo  "EMPTY=$emptyadmin_password et VALID=$vallidadmin_password ";			$iExistAdmin=0;      $iCounter=0;    // Find out of user exist			while ($iCounter < $length_admin)			{				$message_nr = mysql_result($query_admin_all,$iCounter,"Username");				    				if ($message_nr == $_POST['admin3'])				{					$iExistAdmin=1;					break;				}				$iCounter++;			}            			if ($iExistAdmin == 1)			{            				//  update current admin account				if ($vallidadmin_password == 0)				{    					echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");					echo ("<!--\n\n");					echo ("  alert(\"".$Translate[21]."\");\n\n");					echo ("-->\n");					echo ("</script>\n");				}else				{					if ($emptyadmin_password == 1) // update without password					{             						echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");						echo ("<!--\n\n");						echo ("  alert(\"".$Translate[22]."\");\n\n");						echo ("-->\n");						echo ("</script>\n");            if(!mysql_query("UPDATE admin SET DefaultDir='".$_POST['admin3_dir']."',																							QuotaClient='".$_POST['admin3_quota']."',																							Client='".$_POST['admin3_client']."' WHERE Username='".$_POST['admin3']."'",$link))						{							echo ("<br>Error: Not a valid UPDATE query.<br>");							echo ("<br>MySql error : ".mysql_error());						}						else{              //reload              $table_admin_all  = "SELECT * FROM admin ORDER BY Username ASC";				$query_admin_all  = mysql_query($table_admin_all);				$length_admin = mysql_numrows($query_admin_all);                        }					}else					{  						if(!mysql_query("UPDATE admin SET Password='".md5($_POST['admin3_password'])."',																					DefaultDir='".$_POST['admin3_dir']."',																							QuotaClient='".$_POST['admin3_quota']."',																							Client='".$_POST['admin3_client']."' WHERE Username='".$_POST['admin3']."'",$link))						{							echo ("<br>Error: Not a valid UPDATE query.<br>");							echo ("<br>MySql error : ".mysql_error());						}else						{							echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");							echo ("<!--\n\n");							echo ("  alert(\"".$Translate[23]."\");\n\n");							echo ("-->\n");							echo ("</script>\n");														//reload							$table_admin_all  = "SELECT * FROM admin ORDER BY Username ASC";				      $query_admin_all  = mysql_query($table_admin_all);				      $length_admin = mysql_numrows($query_admin_all);						}					}				}			}else // New user			{          				// Create new User				if ($vallidadmin_password == 0 || $emptyadmin_password == 1)				{   					echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");					echo ("<!--\n\n");					echo ("  alert(\"".$Translate[21]."\");\n\n");					echo ("-->\n");					echo ("</script>\n");					$data_saved = 0;				}else				{   					if(!mysql_query("INSERT INTO admin (Username,Password,DefaultDir,Client, QuotaClient) VALUES ('".$_POST['admin3']."','".md5($_POST['admin3_password'])."','".$_POST['admin3_dir']."','".$_POST['admin3_client']."','".$_POST['admin3_quota']."')",$link))					{							echo ("<br>Error: Not a valid INSERT query.<br>");							echo ("<br>MySql error : ".mysql_error());					}				}			   // reload the database users  			$table_admin_all  = "SELECT * FROM admin ORDER BY Username ASC";  			$query_admin_all  = mysql_query($table_admin_all);  			$length_admin = mysql_numrows($query_admin_all);       }					}                   /////////////////////////END - EDIT CREATE ADMIN //////////////////////////			// If the restore button is pressed					if(isset($_GET['restore']) && isset($_GET['username_box']))		{				  $user_delete  = mysql_result($query_users_restore,0,"User");		  $password_delete  = mysql_result($query_users_restore,0,"Password");		  $uid_delete  = mysql_result($query_users_restore,0,"Uid");		  $gid_delete  = mysql_result($query_users_restore,0,"Gid");		  $dir_delete  = mysql_result($query_users_restore,0,"Dir");		  $quotafiles_delete  = mysql_result($query_users_restore,0,"QuotaFiles");		  $quotasize_delete  = mysql_result($query_users_restore,0,"QuotaSize");		  $ulbandwidth_delete  = mysql_result($query_users_restore,0,"ULBandwidth");		  $dlbandwidth_delete  = mysql_result($query_users_restore,0,"DLBandwidth");		  $ipaddress_delete  = mysql_result($query_users_restore,0,"Ipaddress");		  $comment_delete  = mysql_result($query_users_restore,0,"Comment");		  $status_delete  = mysql_result($query_users_restore,0,"Status");		  $ulratio_delete  = mysql_result($query_users_restore,0,"ULRatio");		  $dlratio_delete  = mysql_result($query_users_restore,0,"DLRatio");		  $quotadiskusage_delete  = mysql_result($query_users_restore,0,"QuotaDiskUsage");		  $quotafilesUsage_delete  = mysql_result($query_users_restore,0,"QuotaFilesUsage");		  $Client_delete  = mysql_result($query_users_restore,0,"Client");		  $QuotaClientPercentUser_delete  = mysql_result($query_users_restore,0,"QuotaClientPercentUse");		  $block_delete  = mysql_result($query_users_restore,0,"block");		  		  		  		  		  	if(!mysql_query("INSERT INTO users (User,Password,Uid,Gid,Dir,QuotaFiles,QuotaSize,ULBandwidth,DLBandwidth,ULRatio,dLRatio,Status,Ipaddress,Client,block,Comment)  																							VALUES ('".$user_delete."',  																							'".$password_delete."',  																							'".$uid_delete."',  																							'".$gid_delete."',  																							'".$dir_delete."',  																							'".$quotafiles_delete."',  																							'".$quotasize_delete."',  																							'".$ulbandwidth_delete."',  																							'".$dlbandwidth_delete."',  																							'".$ulratio_delete."',  																							'".$dlratio_delete."',  																							'".$status_delete."',  																							'".$ipaddress_delete."',  																							'".$Client_delete."',  																							'".$block_delete."',  																							'".$comment_delete."')",$link))  					{  							echo ("<br>Error: Not a valid INSERT query.<br>");  							echo ("<br>MySql error : ".mysql_error());  					}		  		  			if(!mysql_query("DELETE FROM corbeille WHERE User='".$_GET['username_box']."'",$link))			{				echo ("<br>Error: Not a valid DELETE query.<br>");				echo ("<br>MySql error : ".mysql_error());			}else			{				if ($Client=="Administrator"){		  $table_users  = "SELECT * FROM users ORDER BY User ASC";		  $table_restore  = "SELECT * FROM corbeille ORDER BY User ASC";		  $query_restore  = mysql_query($table_restore);		  				}		else{      $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY User ASC";    }        $query_users  = mysql_query($table_users);    		if (!$query_restore)			die("<br>Error: Table 'users' from database 'ftpusers' doesn't exist.<br><br>MySql error : ".mysql_error());		$length_restore = mysql_numrows($query_restore);		$length_users = mysql_numrows($query_users);			}			// same effect when the 'new user' button is pressed			$new=1;		          header("location: $_SERVER[PHP_SELF]");		}        // If the delete button is pressed		if(isset($_GET['delete']) && isset($_GET['username_box']))		{		  		  $user_delete  = mysql_result($query_users_uniq,0,"User");		  $password_delete  = mysql_result($query_users_uniq,0,"Password");		  $uid_delete  = mysql_result($query_users_uniq,0,"Uid");		  $gid_delete  = mysql_result($query_users_uniq,0,"Gid");		  $dir_delete  = mysql_result($query_users_uniq,0,"Dir");		  $quotafiles_delete  = mysql_result($query_users_uniq,0,"QuotaFiles");		  $quotasize_delete  = mysql_result($query_users_uniq,0,"QuotaSize");		  $ulbandwidth_delete  = mysql_result($query_users_uniq,0,"ULBandwidth");		  $dlbandwidth_delete  = mysql_result($query_users_uniq,0,"DLBandwidth");		  $ipaddress_delete  = mysql_result($query_users_uniq,0,"Ipaddress");		  $comment_delete  = mysql_result($query_users_uniq,0,"Comment");		  $status_delete  = mysql_result($query_users_uniq,0,"Status");		  $ulratio_delete  = mysql_result($query_users_uniq,0,"ULRatio");		  $dlratio_delete  = mysql_result($query_users_uniq,0,"DLRatio");		  $quotadiskusage_delete  = mysql_result($query_users_uniq,0,"QuotaDiskUsage");		  $quotafilesUsage_delete  = mysql_result($query_users_uniq,0,"QuotaFilesUsage");		  $Client_delete  = mysql_result($query_users_uniq,0,"Client");		  $QuotaClientPercentUser_delete  = mysql_result($query_users_uniq,0,"QuotaClientPercentUse");		  $block_delete  = mysql_result($query_users_uniq,0,"block");		  		  		   																									  	if(!mysql_query("INSERT INTO corbeille (id,User,Password,Uid,Gid,Dir,QuotaFiles,QuotaSize,ULBandwidth,DLBandwidth,ULRatio,dLRatio,Status,Ipaddress,Client,block,Comment)  																							VALUES ('','".$user_delete."',  																							'".$password_delete."',  																							'".$uid_delete."',  																							'".$gid_delete."',  																							'".$dir_delete."',  																							'".$quotafiles_delete."',  																							'".$quotasize_delete."',  																							'".$ulbandwidth_delete."',  																							'".$dlbandwidth_delete."',  																							'".$ulratio_delete."',  																							'".$dlratio_delete."',  																							'".$status_delete."',  																							'".$ipaddress_delete."',  																							'".$Client_delete."',  																							'".$block_delete."',  																							'".$comment_delete."')",$link))  					{  							echo ("<br>Error: Not a valid INSERT query.<br>");  							echo ("<br>MySql error : ".mysql_error());  					}		  		  			if(!mysql_query("DELETE FROM users WHERE User='".$_GET['username_box']."'",$link))			{				echo ("<br>Error: Not a valid DELETE query.<br>");				echo ("<br>MySql error : ".mysql_error());			}else			{				if ($Client=="Administrator"){		  $table_users  = "SELECT * FROM users ORDER BY User ASC";		  $table_restore  = "SELECT * FROM corbeille ORDER BY User ASC";		  $query_restore  = mysql_query($table_restore);		  				}		else{      $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY User ASC";    }        $query_users  = mysql_query($table_users);    		if (!$query_users)			die("<br>Error: Table 'users' from database 'ftpusers' doesn't exist.<br><br>MySql error : ".mysql_error());		$length_restore = mysql_numrows($query_restore);		$length_users = mysql_numrows($query_users);			}			// same effect when the 'new user' button is pressed			$new=1;			header("location: $_SERVER[PHP_SELF]");		}				// If the delete admin button is pressed		if(isset($_GET['delete']) && isset($_GET['admin_box']) && $Client=="Administrator")		{			if(!mysql_query("DELETE FROM admin WHERE Username='".$_GET['admin_box']."'",$link))			{				echo ("<br>Error: Not a valid DELETE query.<br>");				echo ("<br>MySql error : ".mysql_error());			}else			{				$table_admin_all  = "SELECT * FROM admin ORDER BY Username ASC";				$query_admin_all  = mysql_query($table_admin_all);				$length_admin = mysql_numrows($query_admin_all);			}			// same effect when the 'new user' button is pressed			$new=1;		}              		// Lock or unlock button is pressed		if(isset($_GET['lock']) && isset($_GET['username_box']))		{		  		  $block_user  = mysql_result($query_users_uniq,0,"block");            if    ($block_user=="1") {         $_GET['lock']=0;        	echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");  		   	echo ("<!--\n\n");  		   	echo ("  alert(\"".$Translate[118]."\");\n\n");  		   	echo ("-->\n");  		    echo ("</script>\n");      }		  			if(!mysql_query("UPDATE users SET Status='".$_GET['lock']."' WHERE User='".$_GET['username_box']."'",$link))			{				echo ("<br>Error: Not a valid UPDATE query.<br>");				echo ("<br>MySql error : ".mysql_error());			}else			{				if ($Client=="Administrator"){		  $table_users  = "SELECT * FROM users ORDER BY User ASC";		  				}		else{      $table_users  = "SELECT * FROM users WHERE Client='$Client' ORDER BY User ASC";    }    $query_users  = mysql_query($table_users);    		if (!$query_users)			die("<br>Error: Table 'users' from database 'ftpusers' doesn't exist.<br><br>MySql error : ".mysql_error());		$length_users = mysql_numrows($query_users);			}			// $new=1;			$_GET['id'] = $_GET['username_box'];		}    		echo ("<html>\n");		echo ("<head>\n");		echo ("<title>".$Translate[0]." (".$Translate[1].")</title>\n");		echo ("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=$CharSet\">\n");		echo ("<meta name=\"description\" content=\"The ‘User manager for PureFTPd’ is a software project from Machiel Mastenbroek,");		echo (" more information about this free software could be found on my website: http://machiel.generaal.net/index.php?subject=user_manager_pureftpd \">\n");		echo ("<link rel=\"stylesheet\" href=\"$StyleSheet\" type=\"text/css\" />\n");		echo ("</head>\n");		echo ("<body bgcolor=\"#FFFFFF\" text=\"#000000\" link=\"#000000\" onLoad=\"loadScroll()\" onUnload=\"saveScroll()\">\n");		echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");		echo ("<!--\n\n");		echo ("  function danger_popup(user,urlv)\n");		echo ("  {\n");		// echo ("    alert('danger_popup');\n");		echo ("    var user_input = confirm('".$Translate[24]." \"'+user+'\" ".$Translate[25]."');\n");		echo ("    if (user_input == true)\n");		echo ("    {\n");		echo ("      location =  urlv;\n");		echo ("    }\n");		echo ("  }\n\n");		// Some values for the saveScroll function		echo ("	var db = (document.body) ? 1 : 0;\n");		echo (" var scroll = (window.scrollTo) ? 1 : 0;\n");		// Function setCookie		echo (" function setCookie(name, value, expires, path, domain, secure) {\n");		echo ("   var curCookie = name + \"=\" + escape(value) +\n");		echo ("     ((expires) ? \"; expires=\" + expires.toGMTString() : \"\") +\n");		echo ("     ((path) ? \"; path=\" + path : \"\") +\n");		echo ("     ((domain) ? \"; domain=\" + domain : \"\") +\n");		echo ("     ((secure) ? \"; secure\" : \"\");\n");		echo ("   document.cookie = curCookie;\n");		echo (" }\n");		// Function getCookie		echo (" function getCookie(name) {\n");		echo ("   var dc = document.cookie;\n"); 		echo ("  var prefix = name + \"=\";\n"); 		echo ("  var begin = dc.indexOf(\"; \" + prefix);\n"); 		echo ("  if (begin == -1) {\n");		echo ("     begin = dc.indexOf(prefix);\n"); 		echo ("    if (begin != 0) return null;\n"); 		echo ("  } else {\n"); 		echo ("    begin += 2;\n");		echo ("   }\n");		echo ("   var end = document.cookie.indexOf(\";\", begin);\n");		echo ("   if (end == -1) end = dc.length;\n");		echo ("   return unescape(dc.substring(begin + prefix.length, end));\n");		echo (" }\n");		// Function saveScroll		echo ("  function saveScroll() {\n");		echo ("    if (!scroll) return;\n");		echo ("    var now = new Date();\n");		echo ("    now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);\n");		echo ("    var x = (db) ? document.body.scrollLeft : pageXOffset;\n");		echo ("    var y = (db) ? document.body.scrollTop : pageYOffset;\n");		echo ("    if (y == 0 && x == 0) return;\n");		echo ("    setCookie(\"xy\", x + \"_\" + y, now);\n");		// echo ("    confirm('saveScroll x = '+x+' y = '+y);\n");		echo ("  }\n\n");				//Function On change GID and UID		    echo ("  function change_uid_gid(uid) {\n");		echo ("    document.newuserform.gid_box.value=uid.value;\n");		echo ("    document.newuserform.uid_box.value=uid.value;\n");			echo ("  }\n\n");				// Function loadScroll		echo ("  function loadScroll() {\n");		echo ("    if (!scroll) return;\n");		echo ("    var xy = getCookie(\"xy\");\n");		echo ("    if (!xy) return;\n");		echo ("    var ar = xy.split(\"_\");\n");		echo ("    if (ar.length == 2) scrollTo(parseInt(ar[0]), parseInt(ar[1]));\n");		echo ("  }\n");		echo ("-->\n");		echo ("</script>\n");    		echo ("<form action=\"$_SERVER[PHP_SELF]\" method=\"post\" name=\"newuserform\">\n");		echo ("<div align=\"center\">\n");		if ($Client=="Administrator"){   		            echo ("<table class=\"select_user\" border=\"0\" cellpadding=\"1\" cellspacing=\"1\" width=\"850\">\n");    echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");    				echo ("<table border=\"0\" cellpadding=\"0\" cellspacing=\"1\" width=\"850\">\n");		echo ("<tr>\n");		echo ("<td>\n");		echo ("<font size=\"+1\">&nbsp;".$Translate[105]."</font>\n");		echo ("</td>\n");		echo ("<td align=\"right\">");		echo ("<a href=\"$_SERVER[PHP_SELF]?new=1\">");		echo ("<img hspace=\"1\" src=\"$LocationImages/new_ftpuser.gif\" width=\"16\" height=\"21\" align=\"middle\" border=\"0\">");		echo ("<font style=\"vertical-align:middle\">&nbsp;".$Translate[109]."&nbsp;</font></a>");		if ($Client=="Administrator"){		echo ("<a href=\"disconnect.php\">");		echo ("<img hspace=\"1\" src=\"$LocationImages/disconnect.png\" width=\"21\" height=\"21\" align=\"middle\" border=\"0\">");    echo ("<font style=\"vertical-align:middle\">&nbsp;".$Translate[103]."&nbsp;</font></a>");    }		echo ("</tr>\n");		echo ("</table>\n");		echo ("</td>\n");						echo ("</tr>\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");		//////////////////////////////////////////////////////////////////////		    echo ("<table class=\"select_user\" border=\"0\" cellpadding=\"1\" cellspacing=\"1\" width=\"850\">\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");    echo ("<table width=\"850\" border=\"0\">\n");    		echo ("<tr class=\"column_name_select_user\">\n");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\" >".$Translate[32]."</td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[108]."</td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[106]."</td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[107]."</td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[39]."</td>");		echo ("</tr>\n");    		$iCounter2 = 0;		while ($iCounter2 < $length_admin)		{			$user         = mysql_result($query_admin_all,$iCounter2,"Username");			//$password     = mysql_result($query_users,$iCounter,"Password");			$defaultdir          = mysql_result($query_admin_all,$iCounter2,"DefaultDir");			$client          = mysql_result($query_admin_all,$iCounter2,"Client");			$quotaclient          = mysql_result($query_admin_all,$iCounter2,"QuotaClient");      	      echo ("<tr class=\"select_user\">\n");			echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$user."</td>\n");			//echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$password."</td>\n");     			   //echo ("<td title=\"".$dir."\">");echo ("</td>");			   echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$client."</td>\n");									echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$quotaclient." MB </td>\n");			 			echo ("<td align=\"left\" style=\"padding-left: 2px;\" ");if (!is_dir($defaultdir)){echo "bgcolor=\"Red\"";} echo (">".$defaultdir."</td>\n");			echo ("<td align=\"left\" style=\"padding-left: 2px;\">");			if ($user!="Administrator"){			/* Edit admin account */			echo ("<a href=\"$_SERVER[PHP_SELF]?id-admin=$user\">");			echo ("<img src=\"$LocationImages/edit.gif\"  width=\"16\" height=\"18\" border=\"0\" ");			echo ("title=\"".$Translate[60]."\" ");			echo ("alt=\"".$Translate[60]."\"></a>&nbsp;&nbsp;");			/* Delete admin account */			echo ("<a href=\"$_SERVER[PHP_SELF]\" onClick=\"danger_popup('$user',this.href+'?delete=1&admin_box=$user');return false;\">");			echo ("<img src=\"$LocationImages/delete.gif\" width=\"15\" height=\"16\" border=\"0\" ");						echo ("title=\"".$Translate[61]."\" ");			echo ("alt=\"".$Translate[61]."\"></a>&nbsp;&nbsp;");			}			echo ("</td>\n");			echo ("</tr>\n");			////////////////////////////////////////////////////////////		 $iCounter2++;     }          echo ("</table>\n");     echo ("</td>\n");		echo ("</tr>\n");		echo ("</table>\n");     //echo ("<table border=\"0\" cellpadding=\"1\" cellspacing=\"1\" width=\"850\">\n");     	echo ("<br><br>");     			 /////////////////// FORM ADMIN /////////////////////////////		 		 $admin3_password         = "empty";		$admin3_password_confirm  = "empty";		if(!empty($_GET['id-admin']))		{			$iCounter=0;			while ($iCounter < $length_admin)			{        				$userid = mysql_result($query_admin_all,$iCounter,"Username");								if ($userid == $_GET['id-admin'])				{					$user         = $userid;					//$password     = mysql_result($query_admin_all,$iCounter,"Password");					$admin3_dir          = mysql_result($query_admin_all,$iCounter,"DefaultDir");					$admin3_quota          = mysql_result($query_admin_all,$iCounter,"QuotaClient");					$admin3_client          = mysql_result($query_admin_all,$iCounter,"Client");       					break;				}				$iCounter++;			}		}else if(empty($new)) // $new != 1		{			$user             = $_POST['admin3'];			//$password       = "empty";			$admin3_password  = $_POST['admin3_password'];			$admin3_password_confirm = $_POST['admin3_password_confirm'];			$admin3_dir       = $_POST['admin3_dir'];			$admin3_client    = $_POST['admin3_client'];			$admin3_quota    = $_POST['admin3_quota'];		}else		{			$user             = $Translate[10];			$admin3_password  = "";			$admin3_password_confirm = "";			$admin3_dir       = "$DefaultDir";			$admin3_client    = "1";			$admin3_quota       = "100";		}		 		       echo ("<table class=\"edit_user\" width=\"850\">\n");		     echo ("<tr class=\"edit_user\"><td class=\"border_ltb\">$Translate[32]: ");		echo ("<input type=\"text\" name=\"admin3\" value=\"".$user."\"></td>\n");		echo ("</td><td class=\"border_lrtb\"> $Translate[41]:");		// echo (" Password:");		echo ("<input type=\"password\" name=\"admin3_password\" value=\"".$admin3_password."\"> ");		echo (" $Translate[42]:");		// echo (" Password:");		echo ("<input type=\"password\" name=\"admin3_password_confirm\" value=\"".$admin3_password_confirm."\"></td>\n");   		echo ("<tr class=\"edit_user\"><td class=\"border_ltb\">$Translate[108] ");		echo ("<input type=\"text\" name=\"admin3_client\" value=\"".$admin3_client."\"></td>\n");		echo ("<td class=\"border_lrtb\">$Translate[106] ");		echo ("<input type=\"text\" name=\"admin3_dir\" value=\"".$admin3_dir."\"></td>\n");		echo ("<tr class=\"edit_user\"><td class=\"border_ltb\">$Translate[107] ");    		echo ("<input type=\"text\" size=\"8\" name=\"admin3_quota\" value=\"".$admin3_quota."\"></td>\n");		echo ("</td><td class=\"border_lrtb\" align=\"left\">");		echo ("<input type=\"submit\" name=\"save_admin\" value=\"$Translate[67]\">");		echo ("</td></tr>\n");		   echo ("</table>\n");   		}              /////////////////////FIN FORM ADMIN ///////////////////////////////        ////////////AFFICHAGE LISTE UTILISATEUR///////////////////////////    echo ("<br><br>");		echo ("<table class=\"select_user\" border=\"0\" cellpadding=\"1\" cellspacing=\"1\" width=\"850\">\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");    				echo ("<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"850\">\n");		echo ("<tr>\n");		echo ("<td>\n");		echo ("<font size=\"+1\">&nbsp;".$Translate[0]."</font>\n");		echo ("</td>\n");		echo ("<td align=\"right\">");		echo ("<a href=\"$_SERVER[PHP_SELF]?new=1\">");		echo ("<img hspace=\"1\" src=\"$LocationImages/new_ftpuser.gif\" width=\"16\" height=\"21\" align=\"middle\" border=\"0\">");		echo ("<font style=\"vertical-align:middle\">&nbsp;".$Translate[31]."&nbsp;</font></a>");		if ($Client!="Administrator"){    echo ("<a href=\"disconnect.php\">");		echo ("<img hspace=\"1\" src=\"$LocationImages/disconnect.png\" width=\"21\" height=\"21\" align=\"middle\" border=\"0\">");    echo ("<font style=\"vertical-align:middle\">&nbsp;".$Translate[103]."&nbsp;</font></a>");    }				echo ("</td>\n");		echo ("</tr>\n");		echo ("</table>\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");    if ($Client!="Administrator"){    echo ("<table width=\"850\" border=\"0\">\n");        $iCounter = 0;    $QuotaClientUse = 0;		while ($iCounter < $length_users)		{			      $int         = mysql_result($query_users,$iCounter,"QuotaSize"); 			$QuotaClientUse  =  $QuotaClientUse + $int;  			$iCounter++;    }    $QuotaClientRestant=$QuotaClient-$QuotaClientUse;    $QuotaClientPercentUse=$QuotaClientUse*100/$QuotaClient;       		echo ("<tr class=\"column_name_select_user_up\">\n");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[100]." ".$Client."</td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[104]." ".$QuotaClient."M </td>");    echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[101]." ".$QuotaClientRestant."M "."</td>");    echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[102]." ".$QuotaClientPercentUse."% "."</td>");		echo ("</tr>\n");		echo ("</table>\n");		}		echo ("</td>\n");		echo ("</tr>\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");		echo ("<table width=\"850\" border=\"0\">\n");		echo ("<tr class=\"column_name_select_user\">\n");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=user\">".$Translate[32]."</a></td>");		if ($Client=="Administrator"){    echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=user\">".$Translate[108]."</a></td>");    		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=user\">".$Translate[33]."</a></td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=user\">".$Translate[34]."</a></td>");		    echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=user\">".$Translate[35]."</a></td>");    }		//echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[36]."</td>");		//echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[37]."</td>");		//echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[38]."</td>");                echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=quotafull\">".$Translate[44]."</a></td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=quotause\">".$Translate[99]."</a></td>");		    if ($Client!="Administrator"){      echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=dir\">".$Translate[35]."</a></td>");        		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=rights\">".$Translate[117]."</a></td>");		}		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]\">".$Translate[39]."</a></td>");				echo ("</tr>\n");    		$iCounter = 0;		while ($iCounter < $length_users)		{			$user         = mysql_result($query_users,$iCounter,"User");			//$password     = mysql_result($query_users,$iCounter,"Password");			$uid          = mysql_result($query_users,$iCounter,"Uid");			$gid          = mysql_result($query_users,$iCounter,"Gid");			$dir          = mysql_result($query_users,$iCounter,"Dir");			//$ulbandwidth  = mysql_result($query_users,$iCounter,"ULBandwidth");			//$dlbandwidth  = mysql_result($query_users,$iCounter,"DLBandwidth");			$quotasize    =  mysql_result($query_users,$iCounter,"QuotaSize");			$ipaddress    = mysql_result($query_users,$iCounter,"Ipaddress");			$status       = mysql_result($query_users,$iCounter,"Status");			$user_client  = mysql_result($query_users,$iCounter,"Client"); 			$quotafilesusage       = mysql_result($query_users,$iCounter,"QuotaFilesUsage");			$quotadiskusage       = mysql_result($query_users,$iCounter,"QuotaDiskUsage");			$quotapourcent     = round($quotadiskusage/1000/1024/$quotasize*100,2);						//On rempli la base avec le pourcentage par user afin de faire du classement			 if(!mysql_query("UPDATE users SET QuotaClientPercentUse='".$quotapourcent."' WHERE User='".$user."'",$link))  						{  							echo ("<br>Error: Not a valid UPDATE query.<br>");  							echo ("<br>MySql error : ".mysql_error());      	      }			if ($status == 1)				echo ("<tr class=\"select_user\">\n");			else				echo ("<tr class=\"select_locked_user\">\n");			echo ("<td align=\"left\" width=\"140\">");			echo ("<a href=\"$_SERVER[PHP_SELF]?id=$user\" title=\"".$Translate[60]."\">");			// Lock or unlock account			if ($status == 1)					echo ("<img src=\"$LocationImages/ftpuser.gif\" width=\"16\" height=\"18\" border=\"0\" style=\"margin:0px 0px 4px ; vertical-align:middle\">");			else					echo ("<img src=\"$LocationImages/ftpuser_gray.gif\" width=\"16\" height=\"18\" border=\"0\" style=\"margin:0px 0px 4px ; vertical-align:middle\">");			echo ("<input class=\"name\" value=\"$user\" name=\"textfield\" type=\"text\">");			echo ("</a></td>\n");      if ($Client=="Administrator"){      echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$user_client."</td>\n");      			echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$uid."</td>\n");			echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$gid."</td>\n");      			   echo ("<td title=\"".$dir."\">");			   echo ("<input class=\"directory_location\" value=\"".$dir."\" name=\"textfield\" type=\"text\">");			echo ("</td>");			}			// echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$ulbandwidth."</td>\n");			// echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$dlbandwidth."</td>\n");			// echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$ipaddress."</td>\n");			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$quotasize." MB </td>\n");			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$quotapourcent." % </td>\n");			if ($Client!="Administrator"){        echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$dir."</td>\n");  			        if ($uid=="2001"){  			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$Translate[115]." </td>\n");  			}  			elseif ($uid=="2002"){  			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$Translate[116]." </td>\n");  			}  			else{          echo ("<td align=\"left\" style=\"padding-left: 2px;\"> NC </td>\n");        }      }			echo ("<td align=\"center\" width=\"100\">");			/* Edit ftp account */			echo ("<a href=\"$_SERVER[PHP_SELF]?id=$user\">");			if ($status == 1)				echo ("<img src=\"$LocationImages/edit.gif\"  width=\"16\" height=\"18\" border=\"0\" ");			else				echo ("<img src=\"$LocationImages/edit_gray.gif\"  width=\"16\" height=\"18\" border=\"0\" ");			echo ("title=\"".$Translate[60]."\" ");			echo ("alt=\"".$Translate[60]."\"></a>&nbsp;&nbsp;");			/* Delete ftp account */			echo ("<a href=\"$_SERVER[PHP_SELF]\" onClick=\"danger_popup('$user',this.href+'?delete=1&username_box=$user');return false;\">");			if ($status == 1)				echo ("<img src=\"$LocationImages/delete.gif\" width=\"15\" height=\"16\" border=\"0\" ");			else				echo ("<img src=\"$LocationImages/delete_gray.gif\" width=\"15\" height=\"16\" border=\"0\" ");			echo ("title=\"".$Translate[61]."\" ");			echo ("alt=\"".$Translate[61]."\"></a>&nbsp;&nbsp;");			/* Lock or unlock account */			if ($status == 1)			{				echo ("<a href=\"$_SERVER[PHP_SELF]?lock=0&username_box=$user\" >");				echo ("<img src=\"$LocationImages/lock_open.gif\" width=\"14\" height=\"18\" border=\"0\" ");				echo ("title=\"".$Translate[62]."\" ");				echo ("alt=\"".$Translate[62]."\"></a>&nbsp;&nbsp;");			}else			{				echo ("<a href=\"$_SERVER[PHP_SELF]?lock=1&username_box=$user\" >");				echo ("<img src=\"$LocationImages/lock_closed.gif\" width=\"14\" height=\"17\" border=\"0\" ");				echo ("title=\"".$Translate[63]."\" ");				echo ("alt=\"".$Translate[63]."\"></a>&nbsp;&nbsp;");			}			/* Open ftp account */			if ($status == 1)			{				echo ("<a href=\"ftp://$user@".$FTPAddress."\" target=\"_blank\">");				echo ("<img src=\"$LocationImages/connect.gif\" width=\"16\" height=\"18\" border=\"0\" ");				echo ("title=\"".$Translate[64]."\" ");				echo ("alt=\"".$Translate[64]."\"></a>");			}else			{				echo ("<img src=\"$LocationImages/connect_gray.gif\" width=\"16\" height=\"18\" border=\"0\" ");				echo ("alt=\"".$Translate[64]."\" >");			}			echo ("</td>\n");			echo ("</tr>\n");			$iCounter++;		}		echo ("</table>\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("</table>\n");   ///////////////////////////FIN DE LISTAGE DES UTILISATEURS/////////////////////      /////////////////////////////////FORM USER FTP/////////////////////////////////		$password         = "empty";		$confirm_password = "empty";				$QuotaGlobal = mysql_result($query_admin,0,"QuotaClient");		if(!empty($_GET['id']))		{			$iCounter=0;			while ($iCounter < $length_users)			{				$userid = mysql_result($query_users,$iCounter,"User");				if ($userid == $_GET['id'])				{					$user         = $userid;					// $password     = mysql_result($query_users,$iCounter,"Password");					$uid          = mysql_result($query_users,$iCounter,"Uid");					$gid          = mysql_result($query_users,$iCounter,"Gid");					$dir          = mysql_result($query_users,$iCounter,"Dir");					$status       = mysql_result($query_users,$iCounter,"Status");					$quotafiles   = mysql_result($query_users,$iCounter,"QuotaFiles");					$quotasize    = mysql_result($query_users,$iCounter,"QuotaSize");					$ulbandwidth  = mysql_result($query_users,$iCounter,"ULBandwidth");					$dlbandwidth  = mysql_result($query_users,$iCounter,"DLBandwidth");					$dlratio      = mysql_result($query_users,$iCounter,"DLRatio");					$ulratio      = mysql_result($query_users,$iCounter,"ULRatio");					$ipaddress    = mysql_result($query_users,$iCounter,"Ipaddress");					$comment      = mysql_result($query_users,$iCounter,"Comment");					$client_box      = mysql_result($query_users,$iCounter,"Client");					break;				}				$iCounter++;			}		}else if(empty($new)) // $new != 1		{      			$user             = $_POST['username_box'];			//$password         = "empty";			$password         = $_POST['password_box'];			$confirm_password = $_POST['confirm_password_box'];			//$dir              = $_POST['dir_box']."/".$user;      			$status           = $_POST['status_box'];			$quotafiles       = $_POST['quotafiles_box'];			$quotasize        = $_POST['quotasize_box'];			$comment          = $_POST['comment_box'];			$client_box       = $Client;			$uid              = $_POST['uid_box'];			$gid              = $_POST['gid_box'];			if ($Client=="Administrator"){         $client_box       = $_POST['client_box'];			   $ulbandwidth      = $_POST['ulbandwidth_box'];			   $dlbandwidth      = $_POST['dlbandwidth_box'];		     $dlratio          = $_POST['dlratio_box'];			   $ulratio          = $_POST['ulratio_box'];			   $ipaddress        = $_POST['ipaddress_box'];         $dir              = $_POST['dir_box'];		         }      else{         $ulbandwidth      = "0";		     $dlbandwidth      = "0";		     $dlratio          = "0";			   $ulratio          = "0";		     $ipaddress        = "*";			   $client_box       = $Client;			   $dir              = $DefaultDir."/".$user;	      }		}else		{		  			$user             = $Translate[10];			$password         = "";			$confirm_password = "";			$uid              = "";			$gid              = "";			$dir              = $DefaultDir."/".$user;			$status           = "1";			$quotafiles       = "1000";			$quotasize        = 10*100/$QuotaGlobal;			$ulbandwidth      = "0";			$dlbandwidth      = "0";			$dlratio          = "0";			$ulratio          = "0";			$ipaddress        = "*";			$client_box       = $Client;			$comment          = "";		}		$small_erea = 150;		$large_erea = 275;		$middle_erea = 570;		echo ("<br><br>");		echo ("<table class=\"edit_user\" width=\"850\">\n");		echo ("<tr class=\"edit_user\">\n");		echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[32]."</td>\n");		echo ("<td class=\"border_lrtb\" width=\"$middle_erea\">\n&nbsp;");		echo ("<input type=\"text\" name=\"username_box\" size=\"10\" maxlength=\"16\" onchange='document.newuserform.dir_box.value=\"".$DefaultDir."/\"+this.value;' value=\"$user\">\n");		echo ("</td>\n");		echo ("<td class=\"border_rtb\">");		/*		echo ("&nbsp; ".$Translate[40]."  <input type=\"checkbox\" name=\"status_box\" value=\"1\" ");		if ($status == "1")			echo ("checked");		echo (">&nbsp;&nbsp;");		help($Translate[90]);		*/		echo ("<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n");		echo ("<tr>");		echo ("<td>");		echo ("&nbsp;".$Translate[40]);		echo ("</td>\n<td>\n");		echo ("<input type=\"checkbox\" name=\"status_box\" value=\"1\" ");		if ($status == "1")			echo ("checked");		echo (">&nbsp;&nbsp;");		echo ("</td>");		echo ("<td valign=\"bottom\">");		help($Translate[90]);		echo ("</td>");		echo ("</tr>");		echo ("</table>\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("<tr class=\"edit_user\">\n");		echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[41]."</td>\n");		echo ("<td class=\"border_lrtb\" colspan=\"2\">\n&nbsp;");		echo ("<input type=\"password\" name=\"password_box\" size=\"20\" maxlength=\"64\" value=\"$password\">\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("<tr class=\"edit_user\">\n");		echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[42]."</td>\n");		echo ("<td class=\"border_lrtb\" colspan=\"2\">\n&nbsp;");		echo ("<input type=\"password\" name=\"confirm_password_box\" size=\"20\" maxlength=\"64\" value=\"$confirm_password\">\n");		echo ("</td>\n");		echo ("</tr>\n");    if ($Client=="Administrator"){		echo ("<tr class=\"edit_user\">\n");		echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[33]."</td>\n");		echo ("<td class=\"border_lrtb\" colspan=\"2\">\n&nbsp;");		echo ("<select name=\"select_user\" onchange='document.newuserform.uid_box.value=this.value;' style='width: 100px;'>");		echo ("<option value=\"\">select user</option>");		$iCounter = 0;		$iFound_uid = 0;		while ($iCounter < $iNrofunixusers)		{			echo ("<option value=\"".$unix_users[$iCounter][1]."\"");			if ($uid == $unix_users[$iCounter][1])			{				echo (" selected=\"selected\"");			//	$select_user_old = $unix_users[$iCounter][1];				$iFound_uid = 1;			}			echo (">".$unix_users[$iCounter][0]."</option>");			$iCounter++;		    }		echo ("</select>\n");		echo ("<img src=\"$LocationImages/arrow_right.gif\" height=\"10\" width=\"10\"");		echo (" hspace=\"1\" align=\"middle\" border=\"0\"> ");		echo ("<input type=\"text\" name=\"uid_box\" size=\"11\" maxlength=\"11\" value=\"$uid\">\n");		help($Translate[91]);		echo ("</td>\n");		echo ("</tr>\n");    //}		echo ("<tr class=\"edit_user\">\n");		echo ("<td class=\"border_lrtb\" width=\"$small_erea\">".$Translate[34]."</td>\n");		echo ("<td class=\"border_lrtb\" colspan=\"2\">\n&nbsp;");     		echo ("<select name=\"select_group\" onchange='document.newuserform.gid_box.value=this.value;' style='width: 100px;'>");		echo ("<option value=\"\">select group</option>");		$iCounter = 0;		$iFound_gid = 0;		while ($iCounter < $iNrofunixgroups)		{			echo ("<option value=\"".$unix_groups[$iCounter][1]."\"");			if ($gid == $unix_groups[$iCounter][1])			{				echo (" selected=\"selected\"");				// $select_group_old = $unix_groups[$iCounter][1];				$iFound_gid = 1;			}			echo (">".$unix_groups[$iCounter][0]."</option>");			$iCounter++;		}		echo ("</select>\n");    		echo ("<img src=\"$LocationImages/arrow_right.gif\" height=\"10\" width=\"10\"");		echo (" hspace=\"1\" align=\"middle\" border=\"0\"> ");		echo ("<input type=\"text\" name=\"gid_box\" size=\"11\" maxlength=\"11\" value=\"$gid\">\n");		help($Translate[92]);		echo ("</td>\n");		echo ("</tr>\n");    }    else{           echo ("<input type=\"hidden\" name=\"gid_box\" size=\"11\" maxlength=\"11\" value=\"$gid\">\n");       echo ("<input type=\"hidden\" name=\"uid_box\" size=\"11\" maxlength=\"11\" value=\"$uid\">\n");       echo ("<input type=\"hidden\" name=\"dir_box\" size=\"11\" maxlength=\"11\" value=\"$dir\">\n");       echo ("<input type=\"hidden\" name=\"client_box\" size=\"11\" maxlength=\"11\" value=\"$client_box\">\n");       echo ("<input type=\"hidden\" name=\"ulbandwidth_box\" size=\"11\" maxlength=\"11\" value=\"$ulbandwidth\">\n");       echo ("<input type=\"hidden\" name=\"dlbandwidth_box\" size=\"11\" maxlength=\"11\" value=\"$dlbandwidth\">\n");       echo ("<input type=\"hidden\" name=\"quotafiles_box\" size=\"11\" maxlength=\"11\" value=\"$quotafiles\">\n");      echo ("</tr>\n");       echo ("<tr class=\"edit_user\">\n");      echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[112]."</td>\n");      echo ("</td>\n");	        	echo ("<td class=\"border_lrtb\" colspan=\"2\"><select name=\"select_uid\" onchange='change_uid_gid(this);'  style='width: 140px;'>");		echo ("<option value=\"\"  ");if ($uid==""){echo ("selected=\"selected\"");}echo (">Droits Utilisateurs</option>");		  			echo ("<option value=\"2001\" ");if ($uid=="2001"){echo ("selected=\"selected\"");}echo (">Lecture et Ecriture</option>");												echo ("<option value=\"2002\" ");if ($uid=="2002"){echo ("selected=\"selected\"");}echo (">Lecture seulement</option>");					     		  echo ("</select>\n");		  echo (" dans le répertoire de l'utilisateur --> ");		  //echo ("</td>\n");      // Seclection du repertoire de lecture             			  //echo ("</tr>\n");      //echo ("<tr class=\"edit_user\">\n");     // echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[112]."</td>\n");      //echo ("</td>\n");	        	//echo ("<td class=\"border_lrtb\" colspan=\"2\">      echo ("<select name=\"select_dir_user\" onchange='document.newuserform.dir_box.value=this.value;'  style='width: 140px;'>");		echo ("<option value=\"".$DefaultDir."/".$user."\" selected=\"selected\">Répertoire de base</option>");		   $iCounter = 0;		while ($iCounter < $length_users)		{			$user_dir         = mysql_result($query_users,$iCounter,"User");			$dir_users         = mysql_result($query_users,$iCounter,"Dir");			echo ("<option value=\"$dir_users\"");if ($user==$user_dir){echo ("selected=\"selected\"");}echo (">$user_dir</option>");			$iCounter++; 				}						     		  echo ("</select>\n");		  echo ("</td>\n"); 		  echo ("</tr>\n");  		 /* echo ("<tr class=\"edit_user\">\n");      echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[113]."</td>\n");      echo ("</td>\n");	        	echo ("<td class=\"border_lrtb\" colspan=\"2\"><select name=\"select_droits\" style='width: 140px;'>");		echo ("<option value=\"0\" selected=\"selected\">24h</option>");					echo ("<option value=\"1\">Une semaine</option>");			echo ("<option value=\"2\">Un mois</option>");		     		  echo ("</select>\n");		  echo ("</td>\n");   		  echo ("</tr>\n");      */        }		//echo ("<tr class=\"edit_user\">\n");		//echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[35]."</td>\n");				//echo ("<input type=\"text\" name=\"dir_box\" size=\"40\" maxlength=\"128\" value=\"$dir\">\n");		//echo ("</td>\n");		//echo ("<td class=\"border_lrtb\" colspan=\"2\">\n&nbsp;");		    if ($Client=="Administrator"){      echo ("</table>\n");      echo ("<table width=\"850\" class=\"edit_user\">\n");      echo ("<tr class=\"edit_user\">\n");		  echo ("<td class=\"border_lrbt\" width=\"$small_erea\">".$Translate[35]."</td>\n");      echo ("<td class=\"border_lrbt\" width=\"$medium_erea\">\n&nbsp;");      echo ("<input type=\"text\" name=\"dir_box\"  value=\"$dir\">\n");      echo ("</td>\n");      echo ("<td class=\"border_lrbt\" width=\"$small_erea\">".$Translate[108]."</td>\n");      echo ("<td class=\"border_lrbt\" width=\"$medium_erea\">\n&nbsp;");      echo ("<input type=\"text\" name=\"client_box\"  value=\"$client_box\">\n");      echo ("</td>\n");		  echo ("</tr>\n");    }    else{		  //echo ("<input type=\"text\" name=\"dir_box\"  value=\"$dir\">\n");		  echo ("<input type=\"hidden\" name=\"client_box\"  value=\"$client_box\">\n");		  echo ("<input type=\"hidden\" name=\"ipaddress_box\" value=\"$ipaddress\">\n");		  		}				echo ("</table>\n");		echo ("<table width=\"850\" class=\"edit_user\">\n");		echo ("<tr class=\"edit_user\">\n");		    if ($Client=="Administrator"){					echo ("<td class=\"border_lrt\" width=\"$small_erea\">".$Translate[36]."</td>\n");			echo ("<td class=\"border_lr\" width=\"$large_erea\">\n&nbsp;");				echo ("<input type=\"text\" name=\"ulbandwidth_box\" size=\"10\" maxlength=\"10\" value=\"$ulbandwidth\">\n");				help($Translate[93]);			echo ("</td>\n");		}		if ($EnableQuota == 1)		{			echo ("<td class=\"border_lr\" width=\"$small_erea\">".$Translate[43]."</td>\n");			echo ("<td class=\"border_r\">\n&nbsp;");			echo ("<input type=\"text\" name=\"quotafiles_box\" size=\"10\" maxlength=\"10\" value=\"$quotafiles\">\n");				help($Translate[95]);			echo ("</td>\n");		}		else		{			echo ("<td>");			echo ("<input type=\"hidden\" name=\"quotafiles_box\" value=\"$quotafiles\">\n");			echo("</td>\n<td class=\"border_r\">&nbsp;</td>\n");		}    		echo ("</tr>\n");		echo ("<tr class=\"edit_user\">\n");		    if ($Client=="Administrator"){					echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[37]."</td>\n");			echo ("<td class=\"border_lrtb\" width=\"$large_erea\">\n&nbsp;");				echo ("<input type=\"text\" name=\"dlbandwidth_box\" size=\"10\" maxlength=\"10\" value=\"$dlbandwidth\">\n");				help($Translate[94]); 			echo ("</td>\n");    }    else{        echo ("</tr>\n");		echo ("</table>\n");		echo ("<table width=\"850\" class=\"edit_user\">\n");		echo ("<tr class=\"edit_user\">\n");    //  echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[37]."</td>\n");    }    		if ($EnableQuota == 1)		{			echo ("<td class=\"border_lrtb\" width=\"$small_erea\">".$Translate[44]."</td>\n");			echo ("<td class=\"border_rtb\">\n&nbsp;");				echo ("<input type=\"text\" name=\"quotasize_box\" size=\"10\" maxlength=\"10\" value=\"$quotasize\">\n");				help($Translate[96]);			echo ("</td>\n");		}		else		{					echo ("<td>");			echo ("<input type=\"hidden\" name=\"quotasize_box\" value=\"$quotasize\">\n");			echo("</td>\n<td class=\"border_r\">&nbsp;</td>\n");		}		echo ("</tr>\n");    if ($Client=="Administrator"){  		if ($EnableRatio == 1)  		{  				echo ("<tr class=\"edit_user\">\n");  					echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[45]."</td>\n");  					echo ("<td class=\"border_lrtb\" width=\"$large_erea\">\n&nbsp;");  					  						echo ("<input type=\"text\" name=\"ulratio_box\" size=\"2\" maxlength=\"3\" value=\"$ulratio\">");  						echo (" : ");  						echo ("<input type=\"text\" name=\"dlratio_box\" size=\"2\" maxlength=\"3\" value=\"$dlratio\">");  						help($Translate[97]);  					echo ("</td>\n");  					echo ("<td class=\"border_r\" colspan=\"2\">\n&nbsp;</td>");  				echo ("</tr>\n");      		}else  		{    			echo ("<input type=\"hidden\" name=\"ulratio_box\" value=\"$ulratio\">");  			echo ("<input type=\"hidden\" name=\"dlratio_box\" value=\"$dlratio\">");  		}		echo ("<tr class=\"edit_user\">\n");			echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[38]."</td>\n");			echo ("<td class=\"border_lrtb\" width=\"$large_erea\">\n&nbsp;");				echo ("<input type=\"text\" name=\"ipaddress_box\" size=\"20\" maxlength=\"20\" value=\"$ipaddress\">\n");				help($Translate[98]);			echo ("</td>\n");      			echo ("<td class=\"border_r\" colspan=\"2\">\n&nbsp;</td>");		echo ("</tr>\n");    }      else{        echo ("</tr>\n");   		echo ("</table>\n");		echo ("<table width=\"850\" class=\"edit_user\">\n");		echo ("<tr class=\"edit_user\">\n");    //  echo ("<td class=\"border_ltb\" width=\"$small_erea\">".$Translate[37]."</td>\n");    }    		echo ("<tr class=\"edit_user\">\n");		echo ("<td class=\"border_lr\" valign=\"top\" width=\"$small_erea\">".$Translate[46]."</td>\n");		echo ("<td class=\"border_lr\" width=\"$large_erea\">\n");							echo ("<table width=\"100%\"><tr><td>");			echo ("<textarea name=\"comment_box\" cols=\"30\" rows=\"3\" wrap=\"virtual\">".$comment."</textarea>");			echo ("</td></tr></table>");		echo ("</td>\n");		echo ("<td class=\"border_r\" colspan=\"2\">\n&nbsp;</td>");		echo ("</tr>\n");		echo ("<tr class=\"edit_user\" align=\"right\">\n");		echo ("<td class=\"border_lrtb\" height=\"30\" colspan=\"4\">\n");		echo ("<input name=\"save\" type=\"submit\" value=\"".$Translate[67]."\">&nbsp;\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("</table>\n");		/////////////////////////////////////FIN FORM USER FTP//////////////////////////////////////		            //////////////////////////////////DEBUT LISTAGE CORBEILLE/////////////////////////////////////    if ($Client=="Administrator"){   echo ("<br><br>");		echo ("<table class=\"select_user\" border=\"0\" cellpadding=\"1\" cellspacing=\"1\" width=\"850\">\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");    				echo ("<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"850\">\n");		echo ("<tr>\n");		echo ("<td>\n");		echo ("<font size=\"+1\">&nbsp;".$Translate[119]."</font>\n");		echo ("</td>\n");		echo ("<td align=\"right\">");					echo ("</td>\n");		echo ("</tr>\n");		echo ("</table>\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");    echo ("</td>\n");		echo ("</tr>\n");		echo ("<tr bgcolor=\"#FFFFFF\">\n");		echo ("<td>\n");		echo ("<table width=\"850\" border=\"0\">\n");		echo ("<tr class=\"column_name_select_user\">\n");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeilleuser\">".$Translate[32]."</a></td>");		    echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeillepartenaire\">".$Translate[108]."</a></td>");    		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeilleuid\">".$Translate[33]."</a></td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeillegid\">".$Translate[34]."</a></td>");		    echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeilledir\">".$Translate[35]."</a></td>");    		//echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[36]."</td>");		//echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[37]."</td>");		//echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\">".$Translate[38]."</td>");                echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeillequotafull\">".$Translate[44]."</a></td>");		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeillequotause\">".$Translate[99]."</a></td>");		    if ($Client!="Administrator"){      echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeilledir\">".$Translate[35]."</a></td>");        		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]?sort=corbeillerights\">".$Translate[117]."</a></td>");		}		echo ("<td width=\"\" align=\"left\" style=\"padding-left: 2px;\"><a href=\"$_SERVER[PHP_SELF]\">".$Translate[39]."</a></td>");				echo ("</tr>\n");    		$iCounter = 0;		while ($iCounter < $length_restore)		{			$user         = mysql_result($query_restore,$iCounter,"User");			//$password     = mysql_result($query_restore,$iCounter,"Password");			$uid          = mysql_result($query_restore,$iCounter,"Uid");			$gid          = mysql_result($query_restore,$iCounter,"Gid");			$dir          = mysql_result($query_restore,$iCounter,"Dir");			//$ulbandwidth  = mysql_result($query_restore,$iCounter,"ULBandwidth");			//$dlbandwidth  = mysql_result($query_restore,$iCounter,"DLBandwidth");			$quotasize    =  mysql_result($query_restore,$iCounter,"QuotaSize");			$ipaddress    = mysql_result($query_restore,$iCounter,"Ipaddress");			$status       = mysql_result($query_restore,$iCounter,"Status");			$user_client  = mysql_result($query_restore,$iCounter,"Client"); 			$quotafilesusage       = mysql_result($query_restore,$iCounter,"QuotaFilesUsage");			$quotadiskusage       = mysql_result($query_restore,$iCounter,"QuotaDiskUsage");			$quotapourcent     = round($quotadiskusage/1000/1024/$quotasize*100,2);						//On rempli la base avec le pourcentage par user afin de faire du classement			 if(!mysql_query("UPDATE users SET QuotaClientPercentUse='".$quotapourcent."' WHERE User='".$user."'",$link))  						{  							echo ("<br>Error: Not a valid UPDATE query.<br>");  							echo ("<br>MySql error : ".mysql_error());      	      }			if ($status == 1)				echo ("<tr class=\"select_user\">\n");			else				echo ("<tr class=\"select_locked_user\">\n");			echo ("<td align=\"left\" width=\"140\">");						// Lock or unlock account			if ($status == 1)					echo ("<img src=\"$LocationImages/ftpuser.gif\" width=\"16\" height=\"18\" border=\"0\" style=\"margin:0px 0px 4px ; vertical-align:middle\">");			else					echo ("<img src=\"$LocationImages/ftpuser_gray.gif\" width=\"16\" height=\"18\" border=\"0\" style=\"margin:0px 0px 4px ; vertical-align:middle\">");			echo (" $user");			echo ("</td>\n");      if ($Client=="Administrator"){      echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$user_client."</td>\n");      			echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$uid."</td>\n");			echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$gid."</td>\n");      			   echo ("<td title=\"".$dir."\">");			   echo ("<input class=\"directory_location\" value=\"".$dir."\" name=\"textfield\" type=\"text\">");			echo ("</td>");			}			// echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$ulbandwidth."</td>\n");			// echo ("<td align=\"left\" style=\"padding-left: 3px;\">".$dlbandwidth."</td>\n");			// echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$ipaddress."</td>\n");			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$quotasize." MB </td>\n");			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$quotapourcent." % </td>\n");			if ($Client!="Administrator"){        echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$dir."</td>\n");  			        if ($uid=="2001"){  			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$Translate[115]." </td>\n");  			}  			elseif ($uid=="2002"){  			echo ("<td align=\"left\" style=\"padding-left: 2px;\">".$Translate[116]." </td>\n");  			}  			else{          echo ("<td align=\"left\" style=\"padding-left: 2px;\"> NC </td>\n");        }      }			echo ("<td align=\"center\" width=\"100\">");						/* Restore ftp account */			echo ("<a href=\"$_SERVER[PHP_SELF]\" onClick=\"danger_popup('$user',this.href+'?restore=1&username_box=$user');return false;\">");			if ($status == 1)				echo ("<img src=\"$LocationImages/delete.gif\" width=\"15\" height=\"16\" border=\"0\" ");			else				echo ("<img src=\"$LocationImages/delete_gray.gif\" width=\"15\" height=\"16\" border=\"0\" ");			echo ("title=\"".$Translate[61]."\" ");			echo ("alt=\"".$Translate[61]."\"></a>&nbsp;&nbsp;");			echo ("</td>\n");			echo ("</tr>\n");			$iCounter++;		}		echo ("</table>\n");		echo ("</td>\n");		echo ("</tr>\n");		echo ("</table>\n");       }        ////////////////////////////////FIN LISTAGE CORBEILLE///////////////////////////////////////            echo ("</div>\n");		echo ("</form>\n");		// echo ("<script language=\"JavaScript\" type=\"text/javascript\" src=\"includes/wz_tooltip.php\"></script>\n");		echo ("<script language=\"JavaScript\" type=\"text/javascript\">\n");		echo ("<!--\n\n");		require ('includes/wz_tooltip.php');		echo ("-->\n");		echo ("</script>\n");    echo ("<div align=\"center\"> SII - v1.0b - Développé par Olivier Legras </div>  ");		echo ("</body>\n");		echo ("</html>\n");		mysql_close($link);	}?>